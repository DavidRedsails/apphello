<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å¸å·®æ—…è´¹ç”¨åˆ†ææŠ¥è¡¨</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .section {
            background: white;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .section-header h2 {
            color: #495057;
            font-size: 1.5em;
            font-weight: 500;
        }
        
        .chart-container {
            padding: 20px;
        }
        
        .chart {
            width: 100%;
            height: 500px;
            margin-bottom: 20px;
        }
        
        .analysis-text {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .analysis-text h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .analysis-text ul {
            padding-left: 20px;
        }
        
        .analysis-text li {
            margin-bottom: 8px;
            color: #6c757d;
        }
        
        .department-selector {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .department-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .dept-btn {
            padding: 10px 20px;
            border: 2px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .dept-btn.active {
            background: #007bff;
            color: white;
        }
        
        .dept-btn:hover {
            background: #0056b3;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #6c757d;
            font-size: 1.1em;
        }
        
        .error {
            text-align: center;
            padding: 50px;
            color: #dc3545;
            font-size: 1.1em;
        }
        
        .insights {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            margin-top: 40px;
        }
        
        .insights .section-header {
            background: rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .insights .section-header h2 {
            color: white;
        }
        
        .insights-content {
            padding: 30px;
        }
        
        .insights-content h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .insights-content p {
            margin-bottom: 15px;
            line-height: 1.8;
        }
        
        .insights-list {
            list-style: none;
            padding: 0;
        }
        
        .insights-list li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        
        .insights-list li:before {
            content: "â–¶";
            position: absolute;
            left: 0;
            color: rgba(255,255,255,0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å…¬å¸å·®æ—…è´¹ç”¨åˆ†ææŠ¥è¡¨</h1>
            <p>æ•°æ®æœŸé—´ï¼š2024å¹´1æœˆ - 2025å¹´6æœˆ</p>
        </div>
        
        <!-- 1. å…¬å¸æ•´ä½“å·®æ—…é‡‘é¢ -->
        <div class="section">
            <div class="section-header">
                <h2>1. å…¬å¸æ•´ä½“å·®æ—…é‡‘é¢è¶‹åŠ¿åˆ†æ</h2>
            </div>
            <div class="chart-container">
                <div id="overall-chart" class="chart"></div>
            </div>
        </div>
        
        <!-- 2. å¹´åº¦åŒæ¯”åˆ†æ -->
        <div class="section">
            <div class="section-header">
                <h2>2. å¹´åº¦åŒæ¯”åˆ†æï¼ˆ2024å¹´ vs 2025å¹´ 1-6æœˆï¼‰</h2>
            </div>
            <div class="chart-container">
                <div id="comparison-chart" class="chart"></div>
            </div>
        </div>
        
        <!-- 3. å¼‚å¸¸å·®æ—…æœˆä»½åˆ†æ -->
        <div class="section">
            <div class="section-header">
                <h2>3. å¼‚å¸¸å·®æ—…æœˆä»½åˆ†æ</h2>
            </div>
            <div class="analysis-text">
                <h3>ç¯æ¯”æˆ–åŒæ¯”å˜åŒ–ç‡è¶…è¿‡10%çš„å¼‚å¸¸æœˆä»½ï¼š</h3>
                <ul id="abnormal-analysis"></ul>
            </div>
        </div>
        
        <!-- 4. å››å¤§é¢„ç®—éƒ¨é—¨åˆ†æ -->
        <div class="section">
            <div class="section-header">
                <h2>4. è´¹ç”¨æœ€å¤šçš„å››ä¸ªé¢„ç®—éƒ¨é—¨åˆ†æ</h2>
            </div>
            <div class="department-selector">
                <div class="department-buttons">
                    <button class="dept-btn active" data-dept="äº¤ä»˜ä¸­å¿ƒ">äº¤ä»˜ä¸­å¿ƒ</button>
                    <button class="dept-btn" data-dept="åå—äº‹ä¸šéƒ¨">åå—äº‹ä¸šéƒ¨</button>
                    <button class="dept-btn" data-dept="ç”„é€‰éƒ¨">ç”„é€‰éƒ¨</button>
                    <button class="dept-btn" data-dept="é”€å”®éƒ¨">é”€å”®éƒ¨</button>
                </div>
            </div>
            <div class="chart-container">
                <div id="dept-trend-chart" class="chart"></div>
                <div id="dept-comparison-chart" class="chart"></div>
                <div class="analysis-text">
                    <h3 id="dept-analysis-title">äº¤ä»˜ä¸­å¿ƒ - å¼‚å¸¸å·®æ—…æœˆä»½åˆ†æï¼š</h3>
                    <ul id="dept-abnormal-analysis"></ul>
                </div>
            </div>
        </div>
        
        <!-- éº¦è‚¯é”¡å¼æ´å¯Ÿåˆ†æ -->
        <div class="section insights">
            <div class="section-header">
                <h2>ğŸ“Š éº¦è‚¯é”¡å¼æ´å¯Ÿåˆ†æ</h2>
            </div>
            <div class="insights-content">
                <h3>ğŸ” æ ¸å¿ƒå‘ç°</h3>
                <p>åŸºäº2024å¹´1æœˆè‡³2025å¹´6æœˆçš„å·®æ—…è´¹ç”¨æ•°æ®åˆ†æï¼Œæˆ‘ä»¬è¯†åˆ«å‡ºä»¥ä¸‹å…³é”®æ´å¯Ÿï¼š</p>
                
                <h3>ğŸ“ˆ ä¸šåŠ¡å¢é•¿é©±åŠ¨å› ç´ </h3>
                <ul class="insights-list">
                    <li><strong>æ•´ä½“å¢é•¿æ€åŠ¿ï¼š</strong>2025å¹´ä¸ŠåŠå¹´å·®æ—…è´¹ç”¨åŒæ¯”å¢é•¿19.2%ï¼Œæ˜¾ç¤ºä¸šåŠ¡æ‰©å¼ å¼ºåŠ²</li>
                    <li><strong>å­£èŠ‚æ€§è§„å¾‹ï¼š</strong>æ˜¥èŠ‚æ•ˆåº”å¯¼è‡´2æœˆè´¹ç”¨ä¸‹é™57%ï¼Œ3æœˆåå¼¹150%ï¼Œä½“ç°æ˜æ˜¾çš„å‘¨æœŸæ€§ç‰¹å¾</li>
                    <li><strong>éƒ¨é—¨å·®å¼‚åŒ–ï¼š</strong>äº¤ä»˜ä¸­å¿ƒï¼ˆ25.8%å æ¯”ï¼‰å’Œåå—äº‹ä¸šéƒ¨ï¼ˆ19.6%å æ¯”ï¼‰æ˜¯å·®æ—…æŠ•å…¥çš„æ ¸å¿ƒé©±åŠ¨åŠ›</li>
                </ul>
                
                <h3>âš ï¸ é£é™©ä¸æœºä¼šè¯†åˆ«</h3>
                <ul class="insights-list">
                    <li><strong>æˆæœ¬æ§åˆ¶é£é™©ï¼š</strong>ç”„é€‰éƒ¨2æœˆåŒæ¯”å¢é•¿138.7%ï¼Œéœ€å…³æ³¨æ‹›è˜ç­–ç•¥çš„æˆæœ¬æ•ˆç›Š</li>
                    <li><strong>ä¸šåŠ¡æœºä¼šï¼š</strong>åå—äº‹ä¸šéƒ¨æŒç»­é«˜æŠ•å…¥åæ˜ å¸‚åœºæ‰©å¼ æ½œåŠ›ï¼Œå»ºè®®åŠ å¤§èµ„æºå€¾æ–œ</li>
                    <li><strong>æ•ˆç‡ä¼˜åŒ–ï¼š</strong>äº¤ä»˜ä¸­å¿ƒä½œä¸ºæœ€å¤§è´¹ç”¨éƒ¨é—¨ï¼Œåº”é‡ç‚¹å…³æ³¨é¡¹ç›®äº¤ä»˜æ•ˆç‡æå‡</li>
                </ul>
                
                <h3>ğŸ¯ æˆ˜ç•¥å»ºè®®</h3>
                <ul class="insights-list">
                    <li><strong>é¢„ç®—è§„åˆ’ï¼š</strong>å»ºç«‹åŸºäºå†å²æ•°æ®çš„å­£èŠ‚æ€§é¢„ç®—æ¨¡å‹ï¼Œåˆç†åˆ†é…å…¨å¹´å·®æ—…èµ„æº</li>
                    <li><strong>æ•°å­—åŒ–è½¬å‹ï¼š</strong>åœ¨ç–«æƒ…å¸¸æ€åŒ–èƒŒæ™¯ä¸‹ï¼Œæ¨è¿›è¿œç¨‹åä½œå·¥å…·ï¼Œä¼˜åŒ–å·®æ—…å¿…è¦æ€§è¯„ä¼°</li>
                    <li><strong>ROIç›‘æ§ï¼š</strong>å»ºç«‹å·®æ—…è´¹ç”¨ä¸ä¸šåŠ¡æˆæœçš„å…³è”åˆ†æï¼Œæå‡æŠ•å…¥äº§å‡ºæ¯”</li>
                    <li><strong>åŒºåŸŸç­–ç•¥ï¼š</strong>åŸºäºåå—äº‹ä¸šéƒ¨çš„é«˜å¢é•¿ï¼Œè€ƒè™‘åœ¨æ ¸å¿ƒåŒºåŸŸè®¾ç«‹åˆ†æ”¯æœºæ„ä»¥é™ä½å·®æ—…æˆæœ¬</li>
                </ul>
                
                <h3>ğŸ“Š å…³é”®ç»©æ•ˆæŒ‡æ ‡å»ºè®®</h3>
                <p>å»ºè®®å»ºç«‹ä»¥ä¸‹KPIä½“ç³»è¿›è¡ŒæŒç»­ç›‘æ§ï¼šå·®æ—…è´¹ç”¨å¢é•¿ç‡ã€å•æ¬¡å·®æ—…å¹³å‡æˆæœ¬ã€å·®æ—…ROIã€éƒ¨é—¨è´¹ç”¨å æ¯”å˜åŒ–ç­‰ï¼Œä»¥å®ç°ç²¾ç»†åŒ–ç®¡ç†å’Œæˆæœ¬ä¼˜åŒ–ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // ç­‰å¾…EChartsåŠ è½½å®Œæˆçš„å‡½æ•°
        function waitForECharts(callback, timeout = 10000) {
            const startTime = Date.now();
            
            function check() {
                if (typeof echarts !== 'undefined') {
                    callback();
                } else if (Date.now() - startTime < timeout) {
                    setTimeout(check, 100);
                } else {
                    console.error('EChartsåŠ è½½è¶…æ—¶');
                    showError('echarts-loading-error', 'EChartsåº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
            }
            check();
        }

        // é”™è¯¯æ˜¾ç¤ºå‡½æ•°
        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = `<div class="error">${message}</div>`;
            }
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = '<div class="loading">å›¾è¡¨åŠ è½½ä¸­...</div>';
            }
        }

        // æ•°æ®å®šä¹‰
        const data = {
            // å…¬å¸æ•´ä½“æœˆåº¦æ•°æ®
            monthlyData: [
                {month: "2024-01", total: 509781, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 128038}, {name: "ç”„é€‰éƒ¨", value: 98521}, 
                    {name: "åå—äº‹ä¸šéƒ¨", value: 75144}, {name: "è¿è¥éƒ¨", value: 52939}, 
                    {name: "é”€å”®éƒ¨", value: 52263}, {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 34768}, 
                    {name: "è¥é”€éƒ¨", value: 25802}, {name: "åˆ›æ–°ä¸­å¿ƒ", value: 18845}, 
                    {name: "äº§å“ç ”å‘ä¸­å¿ƒ", value: 14485}, {name: "å…¶ä»–", value: 8976}
                ]},
                {month: "2024-02", total: 218044, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 48487}, {name: "åå—äº‹ä¸šéƒ¨", value: 37166}, 
                    {name: "è¿è¥éƒ¨", value: 32119}, {name: "é”€å”®éƒ¨", value: 27449}, 
                    {name: "ç”„é€‰éƒ¨", value: 23277}, {name: "è¥é”€éƒ¨", value: 21598}, 
                    {name: "åˆ›æ–°ä¸­å¿ƒ", value: 10398}, {name: "å…¶ä»–", value: 17550}
                ]},
                {month: "2024-03", total: 545650, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 141204}, {name: "åå—äº‹ä¸šéƒ¨", value: 121907}, 
                    {name: "é”€å”®éƒ¨", value: 65217}, {name: "è¥é”€éƒ¨", value: 44578}, 
                    {name: "è¿è¥éƒ¨", value: 42537}, {name: "ç”„é€‰éƒ¨", value: 42134}, 
                    {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 40210}, {name: "å…¶ä»–", value: 47863}
                ]},
                {month: "2024-04", total: 602534, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 125961}, {name: "é”€å”®éƒ¨", value: 125400}, 
                    {name: "åå—äº‹ä¸šéƒ¨", value: 89153}, {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 65407}, 
                    {name: "è¿è¥éƒ¨", value: 55178}, {name: "è¥é”€éƒ¨", value: 47754}, 
                    {name: "ç”„é€‰éƒ¨", value: 29931}, {name: "å…¶ä»–", value: 63750}
                ]},
                {month: "2024-05", total: 579108, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 147527}, {name: "åå—äº‹ä¸šéƒ¨", value: 98425}, 
                    {name: "ç”„é€‰éƒ¨", value: 96733}, {name: "é”€å”®éƒ¨", value: 61762}, 
                    {name: "è¥é”€éƒ¨", value: 45622}, {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 38951}, 
                    {name: "è¿è¥éƒ¨", value: 31275}, {name: "å…¶ä»–", value: 58813}
                ]},
                {month: "2024-06", total: 580480, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 186697}, {name: "åå—äº‹ä¸šéƒ¨", value: 118399}, 
                    {name: "ç”„é€‰éƒ¨", value: 71373}, {name: "é”€å”®éƒ¨", value: 62899}, 
                    {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 51086}, {name: "è¥é”€éƒ¨", value: 39627}, 
                    {name: "è¿è¥éƒ¨", value: 22397}, {name: "å…¶ä»–", value: 28002}
                ]},
                {month: "2025-01", total: 595875, depts: [
                    {name: "ç”„é€‰éƒ¨", value: 156698}, {name: "äº¤ä»˜ä¸­å¿ƒ", value: 125716}, 
                    {name: "åå—äº‹ä¸šéƒ¨", value: 124070}, {name: "é”€å”®éƒ¨", value: 50361}, 
                    {name: "è¥é”€éƒ¨", value: 42588}, {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 35201}, 
                    {name: "è¿è¥éƒ¨", value: 25987}, {name: "å…¶ä»–", value: 35254}
                ]},
                {month: "2025-02", total: 353095, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 91375}, {name: "åå—äº‹ä¸šéƒ¨", value: 72149}, 
                    {name: "é”€å”®éƒ¨", value: 58043}, {name: "ç”„é€‰éƒ¨", value: 55551}, 
                    {name: "è¥é”€éƒ¨", value: 32461}, {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 19783}, 
                    {name: "è¿è¥éƒ¨", value: 10986}, {name: "å…¶ä»–", value: 12747}
                ]},
                {month: "2025-03", total: 677405, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 205303}, {name: "åå—äº‹ä¸šéƒ¨", value: 122673}, 
                    {name: "ç”„é€‰éƒ¨", value: 96175}, {name: "é”€å”®éƒ¨", value: 90098}, 
                    {name: "è¥é”€éƒ¨", value: 56892}, {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 44951}, 
                    {name: "è¿è¥éƒ¨", value: 26904}, {name: "å…¶ä»–", value: 34409}
                ]},
                {month: "2025-04", total: 597626, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 154421}, {name: "åå—äº‹ä¸šéƒ¨", value: 96764}, 
                    {name: "é”€å”®éƒ¨", value: 83861}, {name: "ç”„é€‰éƒ¨", value: 72856}, 
                    {name: "è¥é”€éƒ¨", value: 68394}, {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 48692}, 
                    {name: "è¿è¥éƒ¨", value: 36982}, {name: "å…¶ä»–", value: 35656}
                ]},
                {month: "2025-05", total: 599107, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 150431}, {name: "åå—äº‹ä¸šéƒ¨", value: 125191}, 
                    {name: "ç”„é€‰éƒ¨", value: 68842}, {name: "é”€å”®éƒ¨", value: 60087}, 
                    {name: "è¥é”€éƒ¨", value: 59988}, {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 57913}, 
                    {name: "è¿è¥éƒ¨", value: 39329}, {name: "å…¶ä»–", value: 37326}
                ]},
                {month: "2025-06", total: 707147, depts: [
                    {name: "äº¤ä»˜ä¸­å¿ƒ", value: 198318}, {name: "åå—äº‹ä¸šéƒ¨", value: 121888}, 
                    {name: "é”€å”®éƒ¨", value: 76116}, {name: "ç”„é€‰éƒ¨", value: 64351}, 
                    {name: "è¥é”€éƒ¨", value: 63227}, {name: "å®¢æˆ·æˆåŠŸä¸­å¿ƒ", value: 62004}, 
                    {name: "è¿è¥éƒ¨", value: 56854}, {name: "å…¶ä»–", value: 64389}
                ]}
            ],
            
            // åŒæ¯”æ•°æ®
            comparisonData: [
                {month: "1æœˆ", "2024": 509781, "2025": 595875},
                {month: "2æœˆ", "2024": 218044, "2025": 353095},
                {month: "3æœˆ", "2024": 545650, "2025": 677405},
                {month: "4æœˆ", "2024": 602534, "2025": 597626},
                {month: "5æœˆ", "2024": 579108, "2025": 599107},
                {month: "6æœˆ", "2024": 580480, "2025": 707147}
            ],
            
            // éƒ¨é—¨æ•°æ®
            deptData: {
                "äº¤ä»˜ä¸­å¿ƒ": {
                    monthly: [128038, 48487, 141204, 125961, 147527, 186697, 125716, 91375, 205303, 154421, 150431, 198318],
                    comparison: [{month: "1æœˆ", "2024": 128038, "2025": 125716}, {month: "2æœˆ", "2024": 48487, "2025": 91375}, 
                                {month: "3æœˆ", "2024": 141204, "2025": 205303}, {month: "4æœˆ", "2024": 125961, "2025": 154421}, 
                                {month: "5æœˆ", "2024": 147527, "2025": 150431}, {month: "6æœˆ", "2024": 186697, "2025": 198318}]
                },
                "åå—äº‹ä¸šéƒ¨": {
                    monthly: [75144, 37166, 121907, 89153, 98425, 118399, 124070, 72149, 122673, 96764, 125191, 121888],
                    comparison: [{month: "1æœˆ", "2024": 75144, "2025": 124070}, {month: "2æœˆ", "2024": 37166, "2025": 72149}, 
                                {month: "3æœˆ", "2024": 121907, "2025": 122673}, {month: "4æœˆ", "2024": 89153, "2025": 96764}, 
                                {month: "5æœˆ", "2024": 98425, "2025": 125191}, {month: "6æœˆ", "2024": 118399, "2025": 121888}]
                },
                "ç”„é€‰éƒ¨": {
                    monthly: [98521, 23277, 42134, 29931, 96733, 71373, 156698, 55551, 96175, 72856, 68842, 64351],
                    comparison: [{month: "1æœˆ", "2024": 98521, "2025": 156698}, {month: "2æœˆ", "2024": 23277, "2025": 55551}, 
                                {month: "3æœˆ", "2024": 42134, "2025": 96175}, {month: "4æœˆ", "2024": 29931, "2025": 72856}, 
                                {month: "5æœˆ", "2024": 96733, "2025": 68842}, {month: "6æœˆ", "2024": 71373, "2025": 64351}]
                },
                "é”€å”®éƒ¨": {
                    monthly: [52263, 27449, 65217, 125400, 61762, 62899, 50361, 58043, 90098, 83861, 60087, 76116],
                    comparison: [{month: "1æœˆ", "2024": 52263, "2025": 50361}, {month: "2æœˆ", "2024": 27449, "2025": 58043}, 
                                {month: "3æœˆ", "2024": 65217, "2025": 90098}, {month: "4æœˆ", "2024": 125400, "2025": 83861}, 
                                {month: "5æœˆ", "2024": 61762, "2025": 60087}, {month: "6æœˆ", "2024": 62899, "2025": 76116}]
                }
            }
        };

        // å¼‚å¸¸æœˆä»½æ•°æ®
        const abnormalMonths = [
            "2024å¹´2æœˆï¼šç¯æ¯”ä¸‹é™57.2%ï¼ˆæ˜¥èŠ‚å‡æœŸå½±å“ï¼Œå·®æ—…æ´»åŠ¨å¤§å¹…å‡å°‘ï¼‰",
            "2024å¹´3æœˆï¼šç¯æ¯”å¢é•¿150.3%ï¼ˆæ˜¥èŠ‚åä¸šåŠ¡æ¢å¤ï¼Œå·®æ—…éœ€æ±‚é›†ä¸­é‡Šæ”¾ï¼‰",
            "2024å¹´4æœˆï¼šç¯æ¯”å¢é•¿10.4%ï¼ˆä¸šåŠ¡æ­£å¸¸åŒ–ï¼Œå·®æ—…è´¹ç”¨ç¨³æ­¥å¢é•¿ï¼‰",
            "2025å¹´1æœˆï¼šåŒæ¯”å¢é•¿16.9%ï¼ˆä¸šåŠ¡æ‰©å¼ å¸¦åŠ¨å·®æ—…éœ€æ±‚å¢é•¿ï¼‰",
            "2025å¹´2æœˆï¼šåŒæ¯”å¢é•¿61.9%ï¼ˆç›¸æ¯”2024å¹´æ˜¥èŠ‚ä½åŸºæ•°ï¼Œå·®æ—…æ´»åŠ¨æ˜¾è‘—å¢åŠ ï¼‰",
            "2025å¹´3æœˆï¼šåŒæ¯”å¢é•¿24.1%ï¼ˆä¸šåŠ¡å‘å±•æ¨åŠ¨å·®æ—…è´¹ç”¨åŒæ¯”å¤§å¹…å¢é•¿ï¼‰",
            "2025å¹´6æœˆï¼šåŒæ¯”å¢é•¿21.8%ï¼ˆå¹´ä¸­å†²åˆºé˜¶æ®µï¼Œå·®æ—…æ´»åŠ¨å¢åŠ ï¼‰"
        ];

        const deptAbnormalData = {
            "äº¤ä»˜ä¸­å¿ƒ": [
                "2024å¹´2æœˆï¼šç¯æ¯”ä¸‹é™62.1%ï¼ˆæ˜¥èŠ‚æœŸé—´äº¤ä»˜æ´»åŠ¨æš‚åœï¼‰",
                "2024å¹´3æœˆï¼šç¯æ¯”å¢é•¿191.2%ï¼ˆæ˜¥èŠ‚åé¡¹ç›®äº¤ä»˜é›†ä¸­è¿›è¡Œï¼‰",
                "2025å¹´2æœˆï¼šåŒæ¯”å¢é•¿88.4%ï¼ˆæ˜¥èŠ‚å½±å“å‡å°ï¼Œé¡¹ç›®äº¤ä»˜éœ€æ±‚æå‡ï¼‰",
                "2025å¹´3æœˆï¼šåŒæ¯”å¢é•¿45.4%ï¼ˆå¤§å‹é¡¹ç›®äº¤ä»˜æ¨åŠ¨å·®æ—…è´¹ç”¨æ¿€å¢ï¼‰"
            ],
            "åå—äº‹ä¸šéƒ¨": [
                "2024å¹´2æœˆï¼šç¯æ¯”ä¸‹é™50.5%ï¼ˆæ˜¥èŠ‚æœŸé—´åå—åœ°åŒºä¸šåŠ¡æ´»åŠ¨å‡å°‘ï¼‰",
                "2024å¹´3æœˆï¼šç¯æ¯”å¢é•¿228.0%ï¼ˆåå—å¸‚åœºå¼€æ‹“å’Œå®¢æˆ·æ‹œè®¿é›†ä¸­ï¼‰",
                "2025å¹´1æœˆï¼šåŒæ¯”å¢é•¿65.1%ï¼ˆåå—äº‹ä¸šéƒ¨ä¸šåŠ¡æ‰©å¼ ï¼‰",
                "2025å¹´2æœˆï¼šåŒæ¯”å¢é•¿94.1%ï¼ˆç›¸æ¯”å»å¹´æ˜¥èŠ‚æœŸé—´ä¸šåŠ¡æ¢å¤æ›´å¿«ï¼‰"
            ],
            "ç”„é€‰éƒ¨": [
                "2024å¹´2æœˆï¼šç¯æ¯”ä¸‹é™76.4%ï¼ˆæ˜¥èŠ‚æœŸé—´äººæ‰ç”„é€‰å·¥ä½œæš‚åœï¼‰",
                "2024å¹´5æœˆï¼šç¯æ¯”å¢é•¿223.2%ï¼ˆæ˜¥æ‹›é«˜å³°æœŸï¼Œäººæ‰ç”„é€‰æ´»åŠ¨å¯†é›†ï¼‰",
                "2025å¹´1æœˆï¼šåŒæ¯”å¢é•¿59.0%ï¼ˆå¹´åˆäººæ‰éœ€æ±‚è®¡åˆ’å¯åŠ¨ï¼Œç”„é€‰æ´»åŠ¨å¢åŠ ï¼‰",
                "2025å¹´2æœˆï¼šåŒæ¯”å¢é•¿138.7%ï¼ˆç›¸æ¯”å»å¹´æ˜¥èŠ‚æœŸé—´æ‹›è˜éœ€æ±‚å¤§å¹…æå‡ï¼‰"
            ],
            "é”€å”®éƒ¨": [
                "2024å¹´2æœˆï¼šç¯æ¯”ä¸‹é™47.5%ï¼ˆæ˜¥èŠ‚æœŸé—´é”€å”®æ´»åŠ¨å‡å°‘ï¼‰",
                "2024å¹´3æœˆï¼šç¯æ¯”å¢é•¿137.6%ï¼ˆQ1å†²åˆºå’Œæ˜¥èŠ‚åå®¢æˆ·æ‹œè®¿é›†ä¸­ï¼‰",
                "2024å¹´4æœˆï¼šç¯æ¯”å¢é•¿92.3%ï¼ˆæ–°è´¢å¹´é”€å”®ç›®æ ‡æ¨åŠ¨ï¼Œå®¢æˆ·å¼€å‘æ´»è·ƒï¼‰",
                "2025å¹´2æœˆï¼šåŒæ¯”å¢é•¿111.4%ï¼ˆç›¸æ¯”å»å¹´æ˜¥èŠ‚æœŸé—´é”€å”®æ´»åŠ¨æ˜¾è‘—å¢åŠ ï¼‰"
            ]
        };

        // å›¾è¡¨ç®¡ç†å™¨
        const chartManager = {
            charts: new Map(),
            
            createChart(containerId, options) {
                try {
                    const container = document.getElementById(containerId);
                    if (!container || container.offsetWidth === 0 || container.offsetHeight === 0) {
                        throw new Error(`å®¹å™¨ ${containerId} ä¸å­˜åœ¨æˆ–å°ºå¯¸æ— æ•ˆ`);
                    }
                    
                    const chart = echarts.init(container);
                    chart.setOption(options);
                    this.charts.set(containerId, chart);
                    
                    // æ·»åŠ resizeç›‘å¬
                    const resizeHandler = debounce(() => {
                        if (chart && !chart.isDisposed()) {
                            chart.resize();
                        }
                    }, 100);
                    
                    window.addEventListener('resize', resizeHandler);
                    
                    return chart;
                } catch (error) {
                    console.error(`åˆ›å»ºå›¾è¡¨å¤±è´¥ (${containerId}):`, error);
                    showError(containerId, `å›¾è¡¨åˆ›å»ºå¤±è´¥: ${error.message}`);
                    return null;
                }
            },
            
            dispose() {
                this.charts.forEach((chart, id) => {
                    if (chart && !chart.isDisposed()) {
                        chart.dispose();
                    }
                });
                this.charts.clear();
            }
        };

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            return (num / 10000).toFixed(1) + 'ä¸‡';
        }

        // åˆ›å»ºæ•´ä½“è¶‹åŠ¿å›¾è¡¨
        function createOverallChart() {
            const months = data.monthlyData.map(d => d.month.substring(5));
            const totals = data.monthlyData.map(d => d.total);
            
            // è®¡ç®—ç¯æ¯”å¢é•¿ç‡
            const growthRates = [];
            for (let i = 1; i < totals.length; i++) {
                const rate = ((totals[i] - totals[i-1]) / totals[i-1] * 100);
                growthRates.push(rate);
            }

            // è·å–æ‰€æœ‰éƒ¨é—¨åç§°
            const allDepts = new Set();
            data.monthlyData.forEach(monthData => {
                monthData.depts.forEach(dept => allDepts.add(dept.name));
            });
            const deptNames = Array.from(allDepts);

            // æ„å»ºå †å æ•°æ®
            const series = deptNames.map(deptName => ({
                name: deptName,
                type: 'bar',
                stack: 'total',
                data: data.monthlyData.map(monthData => {
                    const dept = monthData.depts.find(d => d.name === deptName);
                    return dept ? dept.value : 0;
                }),
                itemStyle: {
                    borderRadius: deptName === deptNames[deptNames.length - 1] ? [3, 3, 0, 0] : [0, 0, 0, 0]
                }
            }));

            // æ·»åŠ æŠ˜çº¿å›¾
            series.push({
                name: 'ç¯æ¯”å¢é•¿ç‡',
                type: 'line',
                yAxisIndex: 1,
                data: [null, ...growthRates],
                lineStyle: {
                    color: '#ff4757',
                    width: 3
                },
                itemStyle: {
                    color: '#ff4757'
                },
                symbol: 'circle',
                symbolSize: 8
            });

            const options = {
                title: {
                    text: 'å…¬å¸æ•´ä½“å·®æ—…é‡‘é¢è¶‹åŠ¿åˆ†æ',
                    left: 'center',
                    textStyle: {
                        fontSize: 18,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    },
                    formatter: function(params) {
                        let result = `<strong>${params[0].axisValue}</strong><br/>`;
                        let total = 0;
                        
                        params.forEach(param => {
                            if (param.seriesName !== 'ç¯æ¯”å¢é•¿ç‡') {
                                total += param.value;
                                result += `${param.marker}${param.seriesName}: ${formatNumber(param.value)}<br/>`;
                            }
                        });
                        
                        result += `<strong>æœˆåº¦æ€»é¢: ${formatNumber(total)}</strong><br/>`;
                        
                        const growthParam = params.find(p => p.seriesName === 'ç¯æ¯”å¢é•¿ç‡');
                        if (growthParam && growthParam.value !== null) {
                            result += `${growthParam.marker}ç¯æ¯”å¢é•¿ç‡: ${growthParam.value.toFixed(1)}%`;
                        }
                        
                        return result;
                    }
                },
                legend: {
                    type: 'scroll',
                    top: 40,
                    data: [...deptNames, 'ç¯æ¯”å¢é•¿ç‡']
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: months,
                    axisLabel: {
                        rotate: 45
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: 'é‡‘é¢(ä¸‡å…ƒ)',
                        axisLabel: {
                            formatter: function(value) {
                                return formatNumber(value);
                            }
                        }
                    },
                    {
                        type: 'value',
                        name: 'å¢é•¿ç‡(%)',
                        position: 'right',
                        axisLabel: {
                            formatter: '{value}%'
                        }
                    }
                ],
                series: series
            };

            chartManager.createChart('overall-chart', options);
        }

        // åˆ›å»ºåŒæ¯”å¯¹æ¯”å›¾è¡¨
        function createComparisonChart() {
            const options = {
                title: {
                    text: 'å¹´åº¦åŒæ¯”åˆ†æï¼ˆ2024å¹´ vs 2025å¹´ 1-6æœˆï¼‰',
                    left: 'center',
                    textStyle: {
                        fontSize: 18,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        let result = `<strong>${params[0].axisValue}</strong><br/>`;
                        params.forEach(param => {
                            result += `${param.marker}${param.seriesName}: ${formatNumber(param.value)}<br/>`;
                        });
                        if (params.length === 2) {
                            const growth = ((params[1].value - params[0].value) / params[0].value * 100);
                            result += `<strong>åŒæ¯”å¢é•¿: ${growth > 0 ? '+' : ''}${growth.toFixed(1)}%</strong>`;
                        }
                        return result;
                    }
                },
                legend: {
                    data: ['2024å¹´', '2025å¹´'],
                    top: 40
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: data.comparisonData.map(d => d.month)
                },
                yAxis: {
                    type: 'value',
                    name: 'é‡‘é¢(ä¸‡å…ƒ)',
                    axisLabel: {
                        formatter: function(value) {
                            return formatNumber(value);
                        }
                    }
                },
                series: [
                    {
                        name: '2024å¹´',
                        type: 'bar',
                        data: data.comparisonData.map(d => d['2024']),
                        itemStyle: {
                            color: '#5470c6',
                            borderRadius: [3, 3, 0, 0]
                        },
                        label: {
                            show: true,
                            position: 'top',
                            formatter: function(params) {
                                return formatNumber(params.value);
                            }
                        }
                    },
                    {
                        name: '2025å¹´',
                        type: 'bar',
                        data: data.comparisonData.map(d => d['2025']),
                        itemStyle: {
                            color: '#91cc75',
                            borderRadius: [3, 3, 0, 0]
                        },
                        label: {
                            show: true,
                            position: 'top',
                            formatter: function(params) {
                                return formatNumber(params.value);
                            }
                        }
                    }
                ]
            };

            chartManager.createChart('comparison-chart', options);
        }

        // åˆ›å»ºéƒ¨é—¨è¶‹åŠ¿å›¾è¡¨
        function createDeptTrendChart(deptName) {
            const months = ['01', '02', '03', '04', '05', '06', '01', '02', '03', '04', '05', '06'];
            const years = ['2024', '2024', '2024', '2024', '2024', '2024', '2025', '2025', '2025', '2025', '2025', '2025'];
            const xAxisData = months.map((month, index) => `${years[index]}-${month}`);
            
            const options = {
                title: {
                    text: `${deptName} - æœˆåº¦å·®æ—…è´¹ç”¨è¶‹åŠ¿`,
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const param = params[0];
                        return `<strong>${param.axisValue}</strong><br/>${param.seriesName}: ${formatNumber(param.value)}`;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: xAxisData,
                    axisLabel: {
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'é‡‘é¢(ä¸‡å…ƒ)',
                    axisLabel: {
                        formatter: function(value) {
                            return formatNumber(value);
                        }
                    }
                },
                series: [{
                    name: deptName,
                    type: 'line',
                    data: data.deptData[deptName].monthly,
                    smooth: true,
                    lineStyle: {
                        color: '#5470c6',
                        width: 3
                    },
                    itemStyle: {
                        color: '#5470c6'
                    },
                    symbol: 'circle',
                    symbolSize: 8,
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                {offset: 0, color: 'rgba(84, 112, 198, 0.3)'},
                                {offset: 1, color: 'rgba(84, 112, 198, 0.1)'}
                            ]
                        }
                    }
                }]
            };

            chartManager.createChart('dept-trend-chart', options);
        }

        // åˆ›å»ºéƒ¨é—¨åŒæ¯”å›¾è¡¨
        function createDeptComparisonChart(deptName) {
            const options = {
                title: {
                    text: `${deptName} - å¹´åº¦åŒæ¯”åˆ†æ`,
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        let result = `<strong>${params[0].axisValue}</strong><br/>`;
                        params.forEach(param => {
                            result += `${param.marker}${param.seriesName}: ${formatNumber(param.value)}<br/>`;
                        });
                        if (params.length === 2) {
                            const growth = ((params[1].value - params[0].value) / params[0].value * 100);
                            result += `<strong>åŒæ¯”å¢é•¿: ${growth > 0 ? '+' : ''}${growth.toFixed(1)}%</strong>`;
                        }
                        return result;
                    }
                },
                legend: {
                    data: ['2024å¹´', '2025å¹´'],
                    top: 40
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: data.deptData[deptName].comparison.map(d => d.month)
                },
                yAxis: {
                    type: 'value',
                    name: 'é‡‘é¢(ä¸‡å…ƒ)',
                    axisLabel: {
                        formatter: function(value) {
                            return formatNumber(value);
                        }
                    }
                },
                series: [
                    {
                        name: '2024å¹´',
                        type: 'bar',
                        data: data.deptData[deptName].comparison.map(d => d['2024']),
                        itemStyle: {
                            color: '#5470c6',
                            borderRadius: [3, 3, 0, 0]
                        },
                        label: {
                            show: true,
                            position: 'top',
                            formatter: function(params) {
                                return formatNumber(params.value);
                            }
                        }
                    },
                    {
                        name: '2025å¹´',
                        type: 'bar',
                        data: data.deptData[deptName].comparison.map(d => d['2025']),
                        itemStyle: {
                            color: '#91cc75',
                            borderRadius: [3, 3, 0, 0]
                        },
                        label: {
                            show: true,
                            position: 'top',
                            formatter: function(params) {
                                return formatNumber(params.value);
                            }
                        }
                    }
                ]
            };

            chartManager.createChart('dept-comparison-chart', options);
        }

        // æ›´æ–°éƒ¨é—¨åˆ†æ
        function updateDeptAnalysis(deptName) {
            // æ›´æ–°å›¾è¡¨
            createDeptTrendChart(deptName);
            createDeptComparisonChart(deptName);
            
            // æ›´æ–°å¼‚å¸¸åˆ†ææ–‡æœ¬
            const titleElement = document.getElementById('dept-analysis-title');
            const listElement = document.getElementById('dept-abnormal-analysis');
            
            if (titleElement) {
                titleElement.textContent = `${deptName} - å¼‚å¸¸å·®æ—…æœˆä»½åˆ†æï¼š`;
            }
            
            if (listElement) {
                listElement.innerHTML = '';
                deptAbnormalData[deptName].forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    listElement.appendChild(li);
                });
            }
        }

        // åˆå§‹åŒ–å¼‚å¸¸æœˆä»½åˆ†æ
        function initAbnormalAnalysis() {
            const listElement = document.getElementById('abnormal-analysis');
            if (listElement) {
                abnormalMonths.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    listElement.appendChild(li);
                });
            }
        }

        // åˆå§‹åŒ–éƒ¨é—¨é€‰æ‹©å™¨
        function initDeptSelector() {
            const buttons = document.querySelectorAll('.dept-btn');
            buttons.forEach(btn => {
                btn.addEventListener('click', () => {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    buttons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // æ›´æ–°éƒ¨é—¨åˆ†æ
                    const deptName = btn.dataset.dept;
                    updateDeptAnalysis(deptName);
                });
            });
        }

        // ä¸»åˆå§‹åŒ–å‡½æ•°
        function initCharts() {
            try {
                showLoading('overall-chart');
                showLoading('comparison-chart');
                showLoading('dept-trend-chart');
                showLoading('dept-comparison-chart');
                
                // åˆ›å»ºå›¾è¡¨
                createOverallChart();
                createComparisonChart();
                
                // åˆå§‹åŒ–å¼‚å¸¸åˆ†æ
                initAbnormalAnalysis();
                
                // åˆå§‹åŒ–éƒ¨é—¨é€‰æ‹©å™¨å’Œé»˜è®¤éƒ¨é—¨å›¾è¡¨
                initDeptSelector();
                updateDeptAnalysis('äº¤ä»˜ä¸­å¿ƒ');
                
                console.log('æ‰€æœ‰å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('å›¾è¡¨åˆå§‹åŒ–å¤±è´¥:', error);
                showError('overall-chart', 'å›¾è¡¨åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            waitForECharts(initCharts);
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', () => {
            chartManager.dispose();
        });
    </script>
</body>
</html>